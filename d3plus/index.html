<!DOCTYPE html>
<html>
<head>
	<title>Test</title>

	<script src="http://www.d3plus.org/js/d3.js"></script>
	<script src="http://www.d3plus.org/js/d3plus.js"></script>
	<script type="text/javascript", src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

</head>
	
<body>

<select id="level">
    <option selected="selected">All</option>
    <option>Graduate</option>
    <option>Undergraduate</option>
</select>

<div id="viz"></div>


<script type="text/javascript">

function make_viz(data){
  var visualization = d3plus.viz()
      .container("#viz")
      .data(data)
      .type("tree_map")
      .id(["naics2_descr","naics3_descr"])
      .size("count")
      .time("AY")
      .draw()
}


var myset = []


function reader (file, variable, condition){

d3.csv(file, function(error, state_crime) {
  if (error) return console.error(error);
  

  state_crime = state_crime.filter(function(d){

       return d[variable] == condition;
  })


  state_crime.forEach(function(d) {
    d3.keys(d).forEach(function(k){
      if(k == "count" & k != "AY"){
        d[k] = +d[k]
      }
    })
  })


for ( var i=0; i < state_crime.length; i++){
 
myset[i] = {"AY" : state_crime[i].AY, "Department" : state_crime[i].Department, "Level" : state_crime[i].Level,
            "naics2_descr" : state_crime[i].naics2_descr,  "naics3_descr" : state_crime[i].naics3_descr, "count" : state_crime[i].count}
         }
       
})
}
 


reader("final.csv","AY","2012");
make_viz(myset);

/*
$("#level").change(function () {

    if($("#level :selected").val()=="Undergraduate")

    {
      $('#viz').empty();
      plot("Ugrad.csv","#viz");

    } else if ($("#level :selected").val()=="Graduate") {
        $('#viz').empty();
        plot("Grad.csv","#viz");
    }
    else {    
              $('#viz').empty();
              plot("final.csv","#viz");

    }
});
*/
	</script>
</body>
</html>